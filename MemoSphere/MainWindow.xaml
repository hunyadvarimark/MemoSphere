<Window x:Class="MemoSphere.WPF.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:views="clr-namespace:WPF.Views"
        xmlns:quizViews="clr-namespace:WPF.Views"
        xmlns:vm="clr-namespace:WPF.ViewModels"
        xmlns:converters="clr-namespace:WPF.Utilities" 
        xmlns:vm2="clr-namespace:WPF.ViewModels.Notes"
        Title="MemoSphere" Height="700" Width="1200">

    <Window.Resources>
        <converters:BoolToVisibilityConverter x:Key="BooleanToVisibilityConverter" />
    </Window.Resources>

    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="300" />
            <ColumnDefinition Width="*" />
        </Grid.ColumnDefinitions>

        <!-- BALOLDALI PANEL: Tárgyak és Témakörök -->
        <Grid Grid.Column="0" Margin="10">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <!-- TÁRGYAK -->
            <TextBlock Grid.Row="0" 
                       Text="📚 Tárgyak" 
                       FontWeight="Bold" 
                       FontSize="14"
                       Margin="0,0,0,8"/>

            <ListBox Grid.Row="1" 
                     ItemsSource="{Binding SubjectsVM.Subjects}" 
                     SelectedItem="{Binding SubjectsVM.SelectedSubject}" 
                     Margin="0,0,0,10"
                     BorderBrush="LightGray"
                     BorderThickness="1">
                <ListBox.ItemTemplate>
                    <DataTemplate>
                        <Grid Margin="0,4">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <TextBlock Grid.Column="0" 
                                       Text="{Binding Title}" 
                                       FontWeight="Bold" 
                                       VerticalAlignment="Center" 
                                       Margin="0,0,10,0"/>
                            <Button Grid.Column="1" 
                                    Command="{Binding RelativeSource={RelativeSource AncestorType=Window}, Path=DataContext.SubjectsVM.EditSubjectCommand}" 
                                    CommandParameter="{Binding}" 
                                    Content="✎" 
                                    Width="24" 
                                    Height="24" 
                                    Margin="0,0,5,0" 
                                    ToolTip="Tantárgy szerkesztése"
                                    Cursor="Hand"
                                    Background="Transparent"
                                    BorderThickness="0"/>
                            <Button Grid.Column="2" 
                                    Command="{Binding RelativeSource={RelativeSource AncestorType=Window}, Path=DataContext.SubjectsVM.DeleteSubjectCommand}" 
                                    CommandParameter="{Binding}" 
                                    Content="🗑️" 
                                    Width="24" 
                                    Height="24" 
                                    ToolTip="Tantárgy törlése"
                                    Cursor="Hand"
                                    Background="Transparent"
                                    BorderThickness="0"/>
                        </Grid>
                    </DataTemplate>
                </ListBox.ItemTemplate>
            </ListBox>

            <Button Grid.Row="2" 
                    Content="➕ Új Tárgy" 
                    Command="{Binding AddSubjectCommand}" 
                    Margin="0,0,0,15"
                    Padding="10,8"
                    Background="#4CAF50"
                    Foreground="White"
                    FontWeight="Bold"
                    BorderThickness="0"
                    Cursor="Hand"/>

            <!-- TÉMAKÖRÖK -->
            <TextBlock Grid.Row="3" 
                       Text="📖 Témakörök" 
                       FontWeight="Bold" 
                       FontSize="14"
                       Margin="0,0,0,8"/>

            <ListBox Grid.Row="4" 
                     ItemsSource="{Binding TopicsVM.Topics}" 
                     SelectedItem="{Binding TopicsVM.SelectedTopic}" 
                     Margin="0,0,0,10"
                     BorderBrush="LightGray"
                     BorderThickness="1">
                <ListBox.ItemTemplate>
                    <DataTemplate>
                        <Grid Margin="0,4">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <TextBlock Grid.Column="0" 
                                       Text="{Binding Title}" 
                                       VerticalAlignment="Center" 
                                       Margin="0,0,10,0"/>
                            <Button Grid.Column="1" 
                                    Command="{Binding RelativeSource={RelativeSource AncestorType=Window}, Path=DataContext.TopicsVM.EditTopicCommand}" 
                                    CommandParameter="{Binding}" 
                                    Content="✎" 
                                    Width="24" 
                                    Height="24" 
                                    Margin="0,0,5,0" 
                                    ToolTip="Témakör szerkesztése"
                                    Cursor="Hand"
                                    Background="Transparent"
                                    BorderThickness="0"/>
                            <Button Grid.Column="2" 
                                    Command="{Binding RelativeSource={RelativeSource AncestorType=Window}, Path=DataContext.TopicsVM.DeleteTopicCommand}" 
                                    CommandParameter="{Binding}" 
                                    Content="🗑️" 
                                    Width="24" 
                                    Height="24" 
                                    ToolTip="Témakör törlése"
                                    Cursor="Hand"
                                    Background="Transparent"
                                    BorderThickness="0"/>
                        </Grid>
                    </DataTemplate>
                </ListBox.ItemTemplate>
            </ListBox>

            <Button Grid.Row="5" 
                    Content="➕ Új Témakör" 
                    Command="{Binding AddTopicCommand}" 
                    Margin="0,0,0,10"
                    Padding="10,8"
                    Background="#2196F3"
                    Foreground="White"
                    FontWeight="Bold"
                    BorderThickness="0"
                    Cursor="Hand"/>

            <!-- KVÍZ INDÍTÁSA GOMB -->
            <Button Grid.Row="6" 
                    Content="🎯 Kvíz Indítása" 
                    Command="{Binding StartQuizCommand}" 
                    Padding="10,12"
                    Background="#FF5722"
                    Foreground="White"
                    FontWeight="Bold"
                    FontSize="14"
                    BorderThickness="0"
                    Cursor="Hand">
                <Button.Style>
                    <Style TargetType="Button">
                        <Style.Triggers>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter Property="Background" Value="LightGray"/>
                            </Trigger>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background" Value="#E64A19"/>
                            </Trigger>
                        </Style.Triggers>
                    </Style>
                </Button.Style>
            </Button>
        </Grid>

        <!-- JOBBOLDALI PANEL: Jegyzetek és Kérdések -->
        <Grid Grid.Column="1" Margin="10">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="180"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <!-- JEGYZETEK LISTA -->
            <TextBlock Grid.Row="0" 
                       Text="📝 Jegyzetek" 
                       FontWeight="Bold" 
                       FontSize="14"
                       Margin="0,0,0,8"/>

            <ListBox Grid.Row="1" 
                     ItemsSource="{Binding NotesVM.Notes}" 
                     SelectedItem="{Binding NotesVM.SelectedNote}"
                     BorderBrush="LightGray"
                     BorderThickness="1">
                <ListBox.ItemTemplate>
                    <DataTemplate>
                        <Grid Margin="0,4">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <TextBlock Grid.Column="0" 
                                       Text="{Binding Note.Title}" 
                                       FontWeight="SemiBold" 
                                       VerticalAlignment="Center" 
                                       Margin="0,0,10,0"/>
                            <Button Grid.Column="1" 
                                    Command="{Binding RelativeSource={RelativeSource AncestorType=Window}, Path=DataContext.GenerateQuestionsCommand}" 
                                    CommandParameter="{Binding Note.Id}" 
                                    Content="🤖" 
                                    Width="24" 
                                    Height="24" 
                                    Margin="0,0,5,0"
                                    ToolTip="Kérdések generálása"
                                    Cursor="Hand"
                                    Background="Transparent"
                                    BorderThickness="0"/>
                            <Button Grid.Column="2" 
                                    Command="{Binding RelativeSource={RelativeSource AncestorType=Window}, Path=DataContext.NotesVM.DeleteNoteCommand}" 
                                    CommandParameter="{Binding}" 
                                    Content="🗑️" 
                                    Width="24" 
                                    Height="24" 
                                    ToolTip="Jegyzet törlése"
                                    Cursor="Hand"
                                    Background="Transparent"
                                    BorderThickness="0"/>
                        </Grid>
                    </DataTemplate>
                </ListBox.ItemTemplate>
            </ListBox>

            <!-- JEGYZET TARTALOM -->
            <Border Grid.Row="2" 
                    Margin="0,10,0,0"
                    BorderBrush="LightGray"
                    BorderThickness="1"
                    CornerRadius="5"
                    Padding="10">
                <StackPanel>
                    <TextBlock Text="{Binding NotesVM.SelectedNote.Note.Title, FallbackValue='Válassz jegyzetet'}" 
                               FontWeight="Bold" 
                               FontSize="16" 
                               Margin="0,0,0,10"/>
                    <ScrollViewer VerticalScrollBarVisibility="Auto" MaxHeight="200">
                        <TextBox Text="{Binding NotesVM.SelectedNote.Note.Content, Mode=OneWay}" 
                                 IsReadOnly="True" 
                                 AcceptsReturn="True" 
                                 TextWrapping="Wrap" 
                                 BorderThickness="0"
                                 Background="Transparent"/>
                    </ScrollViewer>

                    <Button Content="🤖 Kérdések generálása ebből a jegyzetből"
                            Command="{Binding QuestionsVM.GenerateQuestionsCommand}"
                            HorizontalAlignment="Left"
                            Padding="10,8"
                            Margin="0,10,0,0"
                            Background="#9C27B0"
                            Foreground="White"
                            FontWeight="Bold"
                            BorderThickness="0"
                            Cursor="Hand"/>
                </StackPanel>
            </Border>

            <!-- GENERÁLT KÉRDÉSEK -->
            <GroupBox Grid.Row="3" 
                      Header="🎲 Generált Kérdések" 
                      Margin="0,15,0,0"
                      FontWeight="Bold"
                      MaxHeight="200">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <ListBox ItemsSource="{Binding QuestionsVM.Questions}" BorderThickness="0">
                        <ListBox.ItemTemplate>
                            <DataTemplate>
                                <Border BorderBrush="LightGray" 
                                        BorderThickness="1" 
                                        CornerRadius="5" 
                                        Padding="8" 
                                        Margin="0,0,0,8"
                                        Background="WhiteSmoke">
                                    <StackPanel>
                                        <TextBlock Text="{Binding Text}" 
                                                   FontWeight="Bold" 
                                                   TextWrapping="Wrap" />
                                        <ItemsControl ItemsSource="{Binding Options}" Margin="0,5,0,0">
                                            <ItemsControl.ItemTemplate>
                                                <DataTemplate>
                                                    <StackPanel Orientation="Horizontal" Margin="10,2,0,0">
                                                        <TextBlock Text="• " FontWeight="Bold"/>
                                                        <TextBlock Text="{Binding}" />
                                                    </StackPanel>
                                                </DataTemplate>
                                            </ItemsControl.ItemTemplate>
                                        </ItemsControl>
                                        <TextBlock Text="Helyes válasz:" 
                                                   FontWeight="Bold" 
                                                   Margin="0,8,0,2" 
                                                   Foreground="Green"/>
                                        <TextBlock Text="{Binding Answer}" 
                                                   TextWrapping="Wrap" 
                                                   FontStyle="Italic" 
                                                   Foreground="DarkGreen" 
                                                   Margin="10,0,0,0"/>
                                    </StackPanel>
                                </Border>
                            </DataTemplate>
                        </ListBox.ItemTemplate>
                    </ListBox>
                </ScrollViewer>
            </GroupBox>

            <!-- JEGYZET SZERKESZTŐ -->
            <Border Grid.Row="4" 
                    BorderBrush="LightGray" 
                    BorderThickness="1" 
                    CornerRadius="5"
                    Padding="10" 
                    Margin="0,15,0,0">
                <ContentControl Content="{Binding AddNoteVM}">
                    <ContentControl.Resources>
                        <DataTemplate DataType="{x:Type vm2:NoteDetailViewModel}">
                            <views:NoteDetailView />
                        </DataTemplate>
                    </ContentControl.Resources>
                </ContentControl>
            </Border>
        </Grid>

        <!-- OVERLAY: Tárgy hozzáadása/szerkesztése -->
        <Grid Grid.ColumnSpan="2" 
              Visibility="{Binding IsAddingSubject, Converter={StaticResource BooleanToVisibilityConverter}}" 
              Background="#B0000000" 
              Panel.ZIndex="10">
            <Border Width="450" 
                    Height="280" 
                    Background="White" 
                    CornerRadius="10" 
                    Padding="20" 
                    BorderBrush="DarkGray" 
                    BorderThickness="2">
                <Border.Effect>
                    <DropShadowEffect BlurRadius="20" ShadowDepth="0" Opacity="0.5"/>
                </Border.Effect>
                <views:SubjectDetailView DataContext="{Binding SubjectDetailVM}" />
            </Border>
        </Grid>

        <!-- OVERLAY: Témakör hozzáadása/szerkesztése -->
        <Grid Grid.ColumnSpan="2" 
              Visibility="{Binding IsAddingTopic, Converter={StaticResource BooleanToVisibilityConverter}}" 
              Background="#B0000000" 
              Panel.ZIndex="10">
            <Border Width="450" 
                    Height="280" 
                    Background="White" 
                    CornerRadius="10" 
                    Padding="20" 
                    BorderBrush="DarkGray" 
                    BorderThickness="2">
                <Border.Effect>
                    <DropShadowEffect BlurRadius="20" ShadowDepth="0" Opacity="0.5"/>
                </Border.Effect>
                <views:TopicDetailView DataContext="{Binding TopicDetailVM}" />
            </Border>
        </Grid>

        <!-- OVERLAY: KVÍZ -->
        <Grid Grid.ColumnSpan="2" 
              Visibility="{Binding IsQuizActive, Converter={StaticResource BooleanToVisibilityConverter}}" 
              Background="#CC000000" 
              Panel.ZIndex="20">
            <Border MaxWidth="950" 
                    MaxHeight="700" 
                    Background="White" 
                    CornerRadius="15" 
                    Padding="30" 
                    BorderBrush="#FF5722" 
                    BorderThickness="3"
                    Margin="20">
                <Border.Effect>
                    <DropShadowEffect BlurRadius="30" ShadowDepth="0" Opacity="0.7" Color="#FF5722"/>
                </Border.Effect>
                <quizViews:QuizView DataContext="{Binding QuizVM}"/>
            </Border>
        </Grid>
    </Grid>
</Window>