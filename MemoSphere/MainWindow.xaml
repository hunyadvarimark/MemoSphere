<Window x:Class="MemoSphere.WPF.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:views="clr-namespace:WPF.Views"
        xmlns:converters="clr-namespace:WPF.Utilities"
        xmlns:viewModels="clr-namespace:WPF.ViewModels"
        xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
        Title="MemoSphere - Intelligens Tanulási Asszisztens"
        Height="900"
        Width="1600"
        WindowStartupLocation="CenterScreen"
        Background="#F8FAFC">

    <Window.Resources>
        <converters:BoolToVisibilityConverter x:Key="BooleanToVisibilityConverter"/>
        <converters:InvertedBoolToVisibilityConverter x:Key="InvertedBoolToVisibilityConverter"/>
        <converters:RadioButtonCheckedConverter x:Key="RadioButtonCheckedConverter"/>

        <!-- Modern Icon Rail Button Style -->
        <Style x:Key="IconRailButton" TargetType="RadioButton">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Foreground" Value="#64748B"/>
            <Setter Property="Width" Value="72"/>
            <Setter Property="Height" Value="72"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="RadioButton">
                        <Border Background="{TemplateBinding Background}" 
                                CornerRadius="0"
                                Margin="0">
                            <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center">
                                <materialDesign:PackIcon Kind="{Binding Tag, RelativeSource={RelativeSource TemplatedParent}}" 
                                                         Width="28" 
                                                         Height="28" 
                                                         Foreground="{TemplateBinding Foreground}"
                                                         HorizontalAlignment="Center"/>
                            </StackPanel>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
            <Style.Triggers>
                <Trigger Property="IsChecked" Value="True">
                    <Setter Property="Background">
                        <Setter.Value>
                            <LinearGradientBrush StartPoint="0,0" EndPoint="1,0">
                                <GradientStop Color="#6366F1" Offset="0"/>
                                <GradientStop Color="#8B5CF6" Offset="1"/>
                            </LinearGradientBrush>
                        </Setter.Value>
                    </Setter>
                    <Setter Property="Foreground" Value="White"/>
                </Trigger>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#F1F5F9"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <!-- Tab Close Button -->
        <Style x:Key="TabCloseButton" TargetType="Button">
            <Setter Property="Width" Value="20"/>
            <Setter Property="Height" Value="20"/>
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Margin" Value="8,0,0,0"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}"
                                CornerRadius="10">
                            <TextBlock Text="✕"
                                       FontSize="14"
                                       FontWeight="Bold"
                                       Foreground="#94A3B8"
                                       HorizontalAlignment="Center"
                                       VerticalAlignment="Center"/>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#FEE2E2"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <!-- Modern Card Style -->
        <Style x:Key="ModernCard" TargetType="Border">
            <Setter Property="Background" Value="White"/>
            <Setter Property="CornerRadius" Value="16"/>
            <Setter Property="Padding" Value="20"/>
            <Setter Property="Effect">
                <Setter.Value>
                    <DropShadowEffect BlurRadius="20" Direction="270" ShadowDepth="2" Opacity="0.08"/>
                </Setter.Value>
            </Setter>
        </Style>

    </Window.Resources>

    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="72"/>
            <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>

        <!-- ========================================== -->
        <!-- ICON RAIL (Left Side) -->
        <!-- ========================================== -->
        <Border Grid.Column="0" 
                Background="#1E293B">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <!-- Logo -->
                <Border Grid.Row="0" 
                        Height="72"
                        Background="#0F172A"
                        Padding="0">
                    <Border Width="40" Height="40" 
                            CornerRadius="12"
                            HorizontalAlignment="Center"
                            VerticalAlignment="Center">
                        <Border.Background>
                            <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                                <GradientStop Color="#6366F1" Offset="0"/>
                                <GradientStop Color="#8B5CF6" Offset="1"/>
                            </LinearGradientBrush>
                        </Border.Background>
                        <TextBlock Text="🎓" 
                                   FontSize="22" 
                                   HorizontalAlignment="Center" 
                                   VerticalAlignment="Center"/>
                    </Border>
                </Border>

                <!-- Navigation Icons -->
                <StackPanel Grid.Row="1" 
                            Orientation="Vertical" 
                            Margin="0,20,0,0">

                    <RadioButton GroupName="MainNavigation"
                                 Style="{StaticResource IconRailButton}"
                                 Tag="ViewDashboard"
                                 ToolTip="Dashboard"
                                 Command="{Binding ShowDashboardViewCommand}"
                                 IsChecked="{Binding CurrentMainView, ConverterParameter={x:Static viewModels:MainViewType.Dashboard}, Converter={StaticResource RadioButtonCheckedConverter}}"/>

                    <RadioButton GroupName="MainNavigation"
                                 Style="{StaticResource IconRailButton}"
                                 Tag="BookOpenVariant"
                                 ToolTip="Jegyzetek Böngészése"
                                 Command="{Binding ShowBrowserViewCommand}"
                                 IsChecked="{Binding CurrentMainView, ConverterParameter={x:Static viewModels:MainViewType.Browser}, Converter={StaticResource RadioButtonCheckedConverter}}"/>

                    <RadioButton GroupName="MainNavigation"
                                 Style="{StaticResource IconRailButton}"
                                 Tag="PlaylistCheck"
                                 ToolTip="Kvíz Központ"
                                 Command="{Binding ShowQuizCenterCommand}"
                                 IsChecked="{Binding CurrentMainView, ConverterParameter={x:Static viewModels:MainViewType.QuizCenter}, Converter={StaticResource RadioButtonCheckedConverter}}"/>

                </StackPanel>

                <!-- User Section (Bottom) -->
                <Border Grid.Row="2" 
                        Height="72"
                        Background="#0F172A">
                    <Button Background="Transparent"
                            BorderThickness="0"
                            Cursor="Hand"
                            Command="{Binding LogoutCommand}"
                            ToolTip="Kijelentkezés">
                        <materialDesign:PackIcon Kind="Logout" 
                                                 Width="24" 
                                                 Height="24" 
                                                 Foreground="#64748B"/>
                    </Button>
                </Border>
            </Grid>
        </Border>

        <!-- ========================================== -->
        <!-- MAIN CONTENT AREA -->
        <!-- ========================================== -->
        <Grid Grid.Column="1">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <!-- Top Bar -->
            <Border Grid.Row="0" 
                    Background="White" 
                    Padding="32,20"
                    BorderBrush="#E2E8F0"
                    BorderThickness="0,0,0,1">
                <Grid>
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="MemoSphere" 
                                   FontSize="24" 
                                   FontWeight="Bold" 
                                   Foreground="#1E293B" 
                                   VerticalAlignment="Center"/>
                    </StackPanel>

                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                        <!-- Streak Badge -->
                        <Border Background="#FEF3C7"
                                CornerRadius="8"
                                Padding="12,6"
                                Margin="0,0,12,0"
                                VerticalAlignment="Center"
                                Visibility="{Binding DashboardVM.HasOverallStreak, Converter={StaticResource BooleanToVisibilityConverter}}">
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="🔥" FontSize="16" VerticalAlignment="Center" Margin="0,0,6,0"/>
                                <TextBlock Text="{Binding DashboardVM.OverallStreak, StringFormat='{}{0} nap'}"
                                           FontSize="14"
                                           Foreground="#F59E0B"
                                           FontWeight="SemiBold"
                                           VerticalAlignment="Center"/>
                            </StackPanel>
                        </Border>

                        <!-- User Email -->
                        <Border Background="#E8EAF6"
                                CornerRadius="8"
                                Padding="12,6"
                                VerticalAlignment="Center">
                            <StackPanel Orientation="Horizontal">
                                <materialDesign:PackIcon Kind="Account" 
                                                         Width="18" 
                                                         Height="18" 
                                                         Foreground="#6366F1"
                                                         VerticalAlignment="Center"
                                                         Margin="0,0,8,0"/>
                                <TextBlock Text="{Binding CurrentUserEmail, FallbackValue='user@example.com'}" 
                                           FontSize="13" 
                                           Foreground="#6366F1"
                                           FontWeight="SemiBold"
                                           VerticalAlignment="Center"/>
                            </StackPanel>
                        </Border>
                    </StackPanel>
                </Grid>
            </Border>

            <!-- Dynamic Content -->
            <ContentControl Grid.Row="1" Content="{Binding}">
                <ContentControl.Style>
                    <Style TargetType="ContentControl">
                        <Setter Property="ContentTemplate">
                            <Setter.Value>
                                <DataTemplate>
                                    <views:DashboardView DataContext="{Binding DashboardVM}"/>
                                </DataTemplate>
                            </Setter.Value>
                        </Setter>
                        <Style.Triggers>
                            <DataTrigger Binding="{Binding CurrentMainView}" Value="{x:Static viewModels:MainViewType.Browser}">
                                <Setter Property="ContentTemplate">
                                    <Setter.Value>
                                        <DataTemplate>
                                            <views:BrowserView DataContext="{Binding}"/>
                                        </DataTemplate>
                                    </Setter.Value>
                                </Setter>
                            </DataTrigger>

                            <DataTrigger Binding="{Binding CurrentMainView}" Value="{x:Static viewModels:MainViewType.QuizCenter}">
                                <Setter Property="ContentTemplate">
                                    <Setter.Value>
                                        <DataTemplate>
                                            <views:QuizTopicSelectionView DataContext="{Binding QuizSelectionVM}"/>
                                        </DataTemplate>
                                    </Setter.Value>
                                </Setter>
                            </DataTrigger>
                        </Style.Triggers>
                    </Style>
                </ContentControl.Style>
            </ContentControl>

            <!-- ========================================== -->
            <!-- MODAL OVERLAYS -->
            <!-- ========================================== -->

            <!-- Subject Edit Modal -->
            <Grid Grid.RowSpan="2"
                  Visibility="{Binding IsAddingSubject, Converter={StaticResource BooleanToVisibilityConverter}}"
                  Background="#CC000000"
                  Panel.ZIndex="100">
                <Border Width="500"
                        Height="300"
                        Background="White"
                        CornerRadius="20"
                        Padding="32">
                    <Border.Effect>
                        <DropShadowEffect BlurRadius="50" Direction="270" ShadowDepth="10" Opacity="0.3"/>
                    </Border.Effect>
                    <views:SubjectDetailView DataContext="{Binding SubjectDetailVM}" />
                </Border>
            </Grid>

            <!-- Topic Edit Modal -->
            <Grid Grid.RowSpan="2"
                  Visibility="{Binding IsAddingTopic, Converter={StaticResource BooleanToVisibilityConverter}}"
                  Background="#CC000000"
                  Panel.ZIndex="100">
                <Border Width="500"
                        Height="300"
                        Background="White"
                        CornerRadius="20"
                        Padding="32">
                    <Border.Effect>
                        <DropShadowEffect BlurRadius="50" Direction="270" ShadowDepth="10" Opacity="0.3"/>
                    </Border.Effect>
                    <views:TopicDetailView DataContext="{Binding TopicDetailVM}" />
                </Border>
            </Grid>

            <!-- Quiz Modal -->
            <Grid Grid.RowSpan="2"
                  Visibility="{Binding IsQuizActive, Converter={StaticResource BooleanToVisibilityConverter}}"
                  Background="#CC000000"
                  Panel.ZIndex="100">
                <Border MaxWidth="1000"
                        MaxHeight="750"
                        Background="White"
                        CornerRadius="24"
                        Padding="40"
                        Margin="40">
                    <Border.Effect>
                        <DropShadowEffect BlurRadius="60" Direction="270" ShadowDepth="15" Opacity="0.4"/>
                    </Border.Effect>
                    <views:QuizView DataContext="{Binding QuizVM}"/>
                </Border>
            </Grid>

        </Grid>
    </Grid>
</Window>